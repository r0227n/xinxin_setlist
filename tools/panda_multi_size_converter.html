<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panda Icon Multi-Size Converter</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        h1 {
            color: #FF8C00;
            margin-bottom: 30px;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .preview-box {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .preview-box h3 {
            color: #333;
            margin-top: 0;
            font-size: 16px;
        }
        
        .preview-box.original {
            grid-column: span 2;
        }
        
        .canvas-container {
            display: inline-block;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            margin: 10px 0;
        }
        
        .canvas-container.maskable {
            position: relative;
            background: #f0f0f0;
        }
        
        .canvas-container.maskable::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            border: 2px dashed #999;
            pointer-events: none;
            box-sizing: border-box;
        }
        
        svg {
            border: 2px solid #ddd;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
        }
        
        canvas {
            display: block;
            background: transparent;
        }
        
        .download-btn {
            display: inline-block;
            background: #FF8C00;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: bold;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 10px 5px;
            cursor: pointer;
            border: none;
            font-size: 14px;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 140, 0, 0.4);
        }
        
        .download-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .download-all-btn {
            background: #4CAF50;
            padding: 12px 30px;
            font-size: 16px;
            margin: 20px;
        }
        
        .download-all-btn:hover {
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }
        
        .info {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .info h3 {
            color: #FF8C00;
            margin-top: 0;
        }
        
        .size-info {
            background: #fff3e0;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 12px;
            display: inline-block;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.loading {
            background: #fff3cd;
            color: #856404;
        }
        
        .icon-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 5px;
        }
        
        .icon-type.android {
            background: #3DDC84;
            color: white;
        }
        
        .icon-type.ios {
            background: #007AFF;
            color: white;
        }
        
        .icon-type.maskable {
            background: #FF6B6B;
            color: white;
        }
        
        .upload-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            background: #f9f9f9;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .upload-section:hover {
            border-color: #FF8C00;
            background: #fff3e0;
        }
        
        .upload-section.drag-over {
            border-color: #4CAF50;
            background: #e8f5e8;
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.3);
        }
        
        .upload-text {
            text-align: center;
            margin: 10px 0;
            color: #666;
        }
        
        .upload-text.drag-over {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .file-name {
            margin-left: 15px;
            font-weight: bold;
            color: #666;
        }
        
        .color-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .color-input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 10px 0;
        }
        
        .color-input {
            width: 60px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .color-input:hover {
            transform: scale(1.1);
            border-color: #FF8C00;
        }
        
        .color-label {
            font-weight: bold;
            color: #333;
        }
        
        .color-value {
            font-family: monospace;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            min-width: 80px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ SVG ã‚¢ã‚¤ã‚³ãƒ³ ãƒãƒ«ãƒã‚µã‚¤ã‚ºå¤‰æ›</h1>
        
        <div class="upload-section" id="uploadSection">
            <input type="file" id="svgFile" accept=".svg" style="display: none;">
            <div class="upload-text" id="uploadText">
                ğŸ“ SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— or ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ
            </div>
            <button class="download-btn" onclick="document.getElementById('svgFile').click()">ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
            <span id="fileName" class="file-name"></span>
        </div>
        
        <div id="status" class="status loading">SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</div>
        
        <div class="color-section" id="colorSection" style="display: none;">
            <h3>ğŸ¨ ãƒã‚¹ã‚«ãƒ–ãƒ«ã‚¢ã‚¤ã‚³ãƒ³è¨­å®š</h3>
            <div class="color-input-group">
                <span class="color-label">èƒŒæ™¯è‰²:</span>
                <input type="color" id="maskableBackgroundColor" class="color-input" value="#F39801">
                <input type="text" id="maskableColorValue" class="color-value" value="#F39801" placeholder="#RRGGBB">
            </div>
            <p style="font-size: 14px; color: #666; margin: 10px 0;">ğŸ’¡ ãƒã‚¹ã‚«ãƒ–ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã¯æ§˜ã€…ãªå½¢çŠ¶ã«ãƒã‚¹ã‚¯ã•ã‚Œã‚‹ãŸã‚ã€èƒŒæ™¯è‰²ã‚’æŒ‡å®šã§ãã¾ã™</p>
        </div>
        
        <div class="preview-grid">
            <div class="preview-box original">
                <h3>SVG ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                <div id="svgPreview" style="min-height: 256px; display: flex; align-items: center; justify-content: center; background: #f0f0f0; border: 2px dashed #ccc; border-radius: 10px;">
                    <span style="color: #999;">SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</span>
                </div>
                <div class="size-info">SVG (ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«)</div>
            </div>
            
            <div class="preview-box">
                <h3>icon-192x192.png <span class="icon-type android">Android</span></h3>
                <div class="canvas-container">
                    <canvas id="canvas192" width="192" height="192"></canvas>
                </div>
                <div class="size-info">192Ã—192px</div>
                <button class="download-btn" onclick="downloadPNG('192')" id="btn192" disabled>
                    ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </button>
            </div>
            
            <div class="preview-box">
                <h3>icon-512x512.png <span class="icon-type android">Android</span></h3>
                <div class="canvas-container">
                    <canvas id="canvas512" width="512" height="512" style="width: 192px; height: 192px;"></canvas>
                </div>
                <div class="size-info">512Ã—512px</div>
                <button class="download-btn" onclick="downloadPNG('512')" id="btn512" disabled>
                    ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </button>
            </div>
            
            <div class="preview-box">
                <h3>icon-512x512-maskable.png <span class="icon-type maskable">Maskable</span></h3>
                <div class="canvas-container maskable">
                    <canvas id="canvas512m" width="512" height="512" style="width: 192px; height: 192px;"></canvas>
                </div>
                <div class="size-info">512Ã—512px (ã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢ä»˜ã)</div>
                <button class="download-btn" onclick="downloadPNG('512m')" id="btn512m" disabled>
                    ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </button>
            </div>
            
            <div class="preview-box">
                <h3>apple-touch-icon-180x180.png <span class="icon-type ios">iOS</span></h3>
                <div class="canvas-container">
                    <canvas id="canvas180" width="180" height="180"></canvas>
                </div>
                <div class="size-info">180Ã—180px</div>
                <button class="download-btn" onclick="downloadPNG('180')" id="btn180" disabled>
                    ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                </button>
            </div>
        </div>
        
        <button class="download-btn download-all-btn" onclick="downloadAll()" id="btnAll" disabled>
            ğŸ“¦ ã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ (ZIPãƒ•ã‚¡ã‚¤ãƒ«)
        </button>
        
        <button class="download-btn" onclick="regenerateAll()">
            ğŸ”„ å†ç”Ÿæˆ
        </button>
        
        <div class="info">
            <h3>ğŸ“ ç”Ÿæˆã•ã‚Œã‚‹ã‚¢ã‚¤ã‚³ãƒ³</h3>
            <ul>
                <li><strong>icon-192x192.png</strong> - PWAç”¨æ¨™æº–ã‚¢ã‚¤ã‚³ãƒ³ (Android)</li>
                <li><strong>icon-512x512.png</strong> - PWAç”¨é«˜è§£åƒåº¦ã‚¢ã‚¤ã‚³ãƒ³ (Android/Play Store)</li>
                <li><strong>icon-512x512-maskable.png</strong> - ãƒã‚¹ã‚«ãƒ–ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ (Android Adaptive Icon)</li>
                <li><strong>apple-touch-icon-180x180.png</strong> - iOSç”¨ã‚¢ã‚¤ã‚³ãƒ³ (iPhone/iPad)</li>
            </ul>
            
            <h3>ğŸ¯ ãƒã‚¹ã‚«ãƒ–ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã«ã¤ã„ã¦</h3>
            <p>ãƒã‚¹ã‚«ãƒ–ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã¯ã€ãƒ‡ãƒã‚¤ã‚¹ã«ã‚ˆã£ã¦å††å½¢ã€è§’ä¸¸ã€ãƒ†ã‚£ã‚¢ãƒ‰ãƒ­ãƒƒãƒ—å‹ãªã©æ§˜ã€…ãªå½¢çŠ¶ã«ãƒã‚¹ã‚¯ã•ã‚Œã¾ã™ã€‚
            å®‰å…¨é ˜åŸŸï¼ˆä¸­å¤®ã®80%ï¼‰ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’é…ç½®ã—ã¦ã„ã‚‹ãŸã‚ã€ã©ã®å½¢çŠ¶ã§ã‚‚é‡è¦ãªéƒ¨åˆ†ãŒåˆ‡ã‚Œã¾ã›ã‚“ã€‚</p>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        const pngDataUrls = {};
        let loadedSvgElement = null;
        
        window.addEventListener('load', function() {
            setupFileUpload();
        });
        
        function setupFileUpload() {
            const fileInput = document.getElementById('svgFile');
            const uploadSection = document.getElementById('uploadSection');
            const uploadText = document.getElementById('uploadText');
            
            fileInput.addEventListener('change', handleSvgUpload);
            setupColorPicker();
            
            // ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
            uploadSection.addEventListener('click', function() {
                fileInput.click();
            });
            
            uploadSection.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                uploadSection.classList.add('drag-over');
                uploadText.classList.add('drag-over');
                uploadText.textContent = 'ğŸ‰ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ï¼';
            });
            
            uploadSection.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                // è¦ç´ å¤–ã«å‡ºãŸæ™‚ã®ã¿ãƒªã‚»ãƒƒãƒˆ
                if (!uploadSection.contains(e.relatedTarget)) {
                    uploadSection.classList.remove('drag-over');
                    uploadText.classList.remove('drag-over');
                    uploadText.textContent = 'ğŸ“ SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— or ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ';
                }
            });
            
            uploadSection.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                uploadSection.classList.remove('drag-over');
                uploadText.classList.remove('drag-over');
                uploadText.textContent = 'ğŸ“ SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— or ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠ';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    handleDroppedFile(file);
                }
            });
            
            // ãƒšãƒ¼ã‚¸å…¨ä½“ã®ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼ã‚’ç„¡åŠ¹åŒ–
            document.addEventListener('dragover', function(e) {
                e.preventDefault();
            });
            
            document.addEventListener('drop', function(e) {
                e.preventDefault();
            });
        }
        
        function setupColorPicker() {
            const colorInput = document.getElementById('maskableBackgroundColor');
            const colorValue = document.getElementById('maskableColorValue');
            
            // ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã¨ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’åŒæœŸ
            colorInput.addEventListener('input', function() {
                colorValue.value = colorInput.value;
                if (loadedSvgElement) {
                    regenerateAllIcons();
                }
            });
            
            colorValue.addEventListener('input', function() {
                const color = colorValue.value;
                if (/^#[0-9A-Fa-f]{6}$/.test(color)) {
                    colorInput.value = color;
                    if (loadedSvgElement) {
                        regenerateAllIcons();
                    }
                }
            });
        }
        
        function regenerateAllIcons() {
            if (!loadedSvgElement) {
                const statusEl = document.getElementById('status');
                statusEl.className = 'status error';
                statusEl.textContent = 'âš ï¸ ã¾ãšSVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„';
                return;
            }
            generateAllIcons();
        }
        
        function handleSvgUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            handleDroppedFile(file);
        }
        
        function handleDroppedFile(file) {
            const statusEl = document.getElementById('status');
            const fileNameEl = document.getElementById('fileName');
            
            if (!file.type.includes('svg') && !file.name.toLowerCase().endsWith('.svg')) {
                statusEl.className = 'status error';
                statusEl.textContent = 'âš ï¸ SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ (ç¾åœ¨: ' + (file.type || 'ä¸æ˜ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—') + ')';
                return;
            }
            
            fileNameEl.textContent = file.name;
            statusEl.className = 'status loading';
            statusEl.textContent = 'SVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const svgContent = e.target.result;
                    loadSvgFromContent(svgContent);
                } catch (error) {
                    statusEl.className = 'status error';
                    statusEl.textContent = 'âš ï¸ SVGãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }
        
        function loadSvgFromContent(svgContent) {
            const statusEl = document.getElementById('status');
            const svgPreview = document.getElementById('svgPreview');
            
            try {
                // SVGã‚’å®‰å…¨ã«è§£æãƒ»ã‚µãƒ‹ã‚¿ã‚¤ã‚º
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgContent, 'image/svg+xml');
                let svgElement = doc.documentElement;

                if (!svgElement || svgElement.tagName.toLowerCase() !== 'svg') {
                    throw new Error('æœ‰åŠ¹ãªSVGè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }

                // å±é™ºè¦ç´ ã¨å±æ€§ã‚’é™¤å»
                doc.querySelectorAll('script, foreignObject').forEach(el => el.remove());
                doc.querySelectorAll('*').forEach(el => {
                    [...el.attributes].forEach(attr => {
                        const name = attr.name;
                        if (/^on/i.test(name)) el.removeAttribute(name); // onload ç­‰
                        if (name === 'href' || name === 'xlink:href') {
                            const val = attr.value || '';
                            if (/^(https?:)?\\/\\//i.test(val)) el.removeAttribute(name); // å¤–éƒ¨å‚ç…§ã‚’ç¦æ­¢
                        }
                    });
                });

                // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«å·®ã—è¾¼ã‚€
                svgPreview.innerHTML = '';
                svgPreview.appendChild(svgElement);
                
                // SVGã‚µã‚¤ã‚ºã‚’èª¿æ•´
                svgElement.setAttribute('width', '256');
                svgElement.setAttribute('height', '256');
                svgElement.style.maxWidth = '100%';
                svgElement.style.height = 'auto';
                
                loadedSvgElement = svgElement;
                
                // ã‚«ãƒ©ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                document.getElementById('colorSection').style.display = 'block';
                
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… SVGãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸï¼ ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆã—ã¾ã—ã‚‡ã†ã€‚';
                
                // ã‚¢ã‚¤ã‚³ãƒ³ç”Ÿæˆã‚’å®Ÿè¡Œ
                setTimeout(generateAllIcons, 500);
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'âš ï¸ SVGãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message;
                console.error(error);
            }
        }
        
        function generateAllIcons() {
            if (!loadedSvgElement) {
                const statusEl = document.getElementById('status');
                statusEl.className = 'status error';
                statusEl.textContent = 'âš ï¸ ã¾ãšSVGãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„';
                return;
            }
            
            const statusEl = document.getElementById('status');
            statusEl.className = 'status loading';
            statusEl.textContent = 'ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆä¸­...';
            
            // å„ã‚µã‚¤ã‚ºã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”Ÿæˆ
            generateIcon(192, 'canvas192', 'btn192', false);
            generateIcon(512, 'canvas512', 'btn512', false);
            generateIcon(512, 'canvas512m', 'btn512m', true); // maskable
            generateIcon(180, 'canvas180', 'btn180', false);
            
            setTimeout(() => {
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… ã™ã¹ã¦ã®ã‚¢ã‚¤ã‚³ãƒ³ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼';
                document.getElementById('btnAll').disabled = false;
            }, 500);
        }
        
        function generateIcon(size, canvasId, btnId, isMaskable) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const btn = document.getElementById(btnId);
            
            if (!loadedSvgElement) {
                btn.disabled = true;
                return;
            }
            
            try {
                ctx.clearRect(0, 0, size, size);
                
                // ãƒã‚¹ã‚«ãƒ–ãƒ«ã®å ´åˆã¯ç¸®å°ã—ã¦ä¸­å¤®ã«é…ç½®ï¼ˆã‚»ãƒ¼ãƒ•ã‚¨ãƒªã‚¢å¯¾å¿œï¼‰
                const scaleFactor = isMaskable ? 0.8 : 1.0;
                const actualSize = size * scaleFactor;
                const offset = (size - actualSize) / 2;
                
                // ãƒã‚¹ã‚«ãƒ–ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã®å ´åˆã€æŒ‡å®šã•ã‚ŒãŸèƒŒæ™¯è‰²ã§å…¨ä½“ã‚’å¡—ã‚Šã¤ã¶ã™
                if (isMaskable) {
                    const backgroundColor = document.getElementById('maskableBackgroundColor').value;
                    ctx.fillStyle = backgroundColor;
                    ctx.fillRect(0, 0, size, size);
                }
                
                // SVGã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦èª­ã¿è¾¼ã‚“ã§canvasã«æç”»
                const svgData = new XMLSerializer().serializeToString(loadedSvgElement);
                const svgBlob = new Blob([svgData], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(svgBlob);
                
                const img = new Image();
                img.onload = function() {
                    ctx.drawImage(img, offset, offset, actualSize, actualSize);
                    
                    // ãƒ‡ãƒ¼ã‚¿URLã‚’ä¿å­˜
                    const key = isMaskable ? size + 'm' : size.toString();
                    pngDataUrls[key] = canvas.toDataURL('image/png');
                    btn.disabled = false;
                    
                    URL.revokeObjectURL(url);
                };
                
                img.onerror = function() {
                    console.error(`Error loading SVG for ${size}px icon`);
                    btn.disabled = true;
                    URL.revokeObjectURL(url);
                };
                
                img.src = url;
                
            } catch (e) {
                console.error(`Error generating ${size}px icon:`, e);
                btn.disabled = true;
            }
        }
        
        function regenerateAll() {
            regenerateAllIcons();
        }
        
        function downloadPNG(sizeKey) {
            const dataUrl = pngDataUrls[sizeKey];
            if (!dataUrl) {
                alert('ã‚¢ã‚¤ã‚³ãƒ³ãŒã¾ã ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return;
            }
            
            let filename;
            switch(sizeKey) {
                case '192':
                    filename = 'icon-192x192.png';
                    break;
                case '512':
                    filename = 'icon-512x512.png';
                    break;
                case '512m':
                    filename = 'icon-512x512-maskable.png';
                    break;
                case '180':
                    filename = 'apple-touch-icon-180x180.png';
                    break;
            }
            
            // ãƒ‡ãƒ¼ã‚¿URLã‹ã‚‰Blobã‚’ä½œæˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const arr = dataUrl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            
            while(n--){
                u8arr[n] = bstr.charCodeAt(n);
            }
            
            const blob = new Blob([u8arr], {type: mime});
            saveAs(blob, filename);
        }
        
        async function downloadAll() {
            const zip = new JSZip();
            
            // å„ã‚¢ã‚¤ã‚³ãƒ³ã‚’ZIPã«è¿½åŠ 
            const icons = [
                { key: '192', name: 'icon-192x192.png' },
                { key: '512', name: 'icon-512x512.png' },
                { key: '512m', name: 'icon-512x512-maskable.png' },
                { key: '180', name: 'apple-touch-icon-180x180.png' }
            ];
            
            for (const icon of icons) {
                const dataUrl = pngDataUrls[icon.key];
                if (dataUrl) {
                    // ãƒ‡ãƒ¼ã‚¿URLã‹ã‚‰Base64éƒ¨åˆ†ã‚’æŠ½å‡º
                    const base64 = dataUrl.split(',')[1];
                    zip.file(icon.name, base64, {base64: true});
                }
            }
            
            // manifest.json ã®ã‚µãƒ³ãƒ—ãƒ«ã‚‚è¿½åŠ 
            const manifest = {
                "name": "Your App Name",
                "short_name": "YourApp",
                "icons": [
                    {
                        "src": "icon-192x192.png",
                        "sizes": "192x192",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon-512x512.png",
                        "sizes": "512x512",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon-512x512-maskable.png",
                        "sizes": "512x512",
                        "type": "image/png",
                        "purpose": "maskable"
                    }
                ],
                "theme_color": "#000000",
                "background_color": "#ffffff",
                "display": "standalone"
            };
            
            zip.file("manifest.json", JSON.stringify(manifest, null, 2));
            
            // ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const content = await zip.generateAsync({type: "blob"});
            const timestamp = new Date().toISOString().slice(0, 10);
            saveAs(content, `app-icons-${timestamp}.zip`);
        }
    </script>
</body>
</html>