<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panda Icon Multi-Size Converter</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        h1 {
            color: #FF8C00;
            margin-bottom: 30px;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .preview-box {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .preview-box h3 {
            color: #333;
            margin-top: 0;
            font-size: 16px;
        }
        
        .preview-box.original {
            grid-column: span 2;
        }
        
        .canvas-container {
            display: inline-block;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            margin: 10px 0;
        }
        
        .canvas-container.maskable {
            position: relative;
            background: #f0f0f0;
        }
        
        .canvas-container.maskable::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            border: 2px dashed #999;
            pointer-events: none;
            box-sizing: border-box;
        }
        
        svg {
            border: 2px solid #ddd;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
        }
        
        canvas {
            display: block;
            background: transparent;
        }
        
        .download-btn {
            display: inline-block;
            background: #FF8C00;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: bold;
            transition: transform 0.3s, box-shadow 0.3s;
            margin: 10px 5px;
            cursor: pointer;
            border: none;
            font-size: 14px;
        }
        
        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 140, 0, 0.4);
        }
        
        .download-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .download-all-btn {
            background: #4CAF50;
            padding: 12px 30px;
            font-size: 16px;
            margin: 20px;
        }
        
        .download-all-btn:hover {
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
        }
        
        .info {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        
        .info h3 {
            color: #FF8C00;
            margin-top: 0;
        }
        
        .size-info {
            background: #fff3e0;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 12px;
            display: inline-block;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.loading {
            background: #fff3cd;
            color: #856404;
        }
        
        .icon-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 5px;
        }
        
        .icon-type.android {
            background: #3DDC84;
            color: white;
        }
        
        .icon-type.ios {
            background: #007AFF;
            color: white;
        }
        
        .icon-type.maskable {
            background: #FF6B6B;
            color: white;
        }
        
        .upload-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            background: #f9f9f9;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .upload-section:hover {
            border-color: #FF8C00;
            background: #fff3e0;
        }
        
        .upload-section.drag-over {
            border-color: #4CAF50;
            background: #e8f5e8;
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.3);
        }
        
        .upload-text {
            text-align: center;
            margin: 10px 0;
            color: #666;
        }
        
        .upload-text.drag-over {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .file-name {
            margin-left: 15px;
            font-weight: bold;
            color: #666;
        }
        
        .color-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .color-input-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 10px 0;
        }
        
        .color-input {
            width: 60px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .color-input:hover {
            transform: scale(1.1);
            border-color: #FF8C00;
        }
        
        .color-label {
            font-weight: bold;
            color: #333;
        }
        
        .color-value {
            font-family: monospace;
            background: #f0f0f0;
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            min-width: 80px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® SVG „Ç¢„Ç§„Ç≥„É≥ „Éû„É´„ÉÅ„Çµ„Ç§„Ç∫Â§âÊèõ</h1>
        
        <div class="upload-section" id="uploadSection">
            <input type="file" id="svgFile" accept=".svg" style="display: none;">
            <div class="upload-text" id="uploadText">
                üìÅ SVG„Éï„Ç°„Ç§„É´„Çí„Åì„Åì„Å´„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó or „ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÅ∏Êäû
            </div>
            <button class="download-btn" onclick="document.getElementById('svgFile').click()">üìÅ „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû</button>
            <span id="fileName" class="file-name"></span>
        </div>
        
        <div id="status" class="status loading">SVG„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
        
        <div class="color-section" id="colorSection" style="display: none;">
            <h3>üé® „Éû„Çπ„Ç´„Éñ„É´„Ç¢„Ç§„Ç≥„É≥Ë®≠ÂÆö</h3>
            <div class="color-input-group">
                <span class="color-label">ËÉåÊôØËâ≤:</span>
                <input type="color" id="maskableBackgroundColor" class="color-input" value="#F39801">
                <input type="text" id="maskableColorValue" class="color-value" value="#F39801" placeholder="#RRGGBB">
            </div>
            <p style="font-size: 14px; color: #666; margin: 10px 0;">üí° „Éû„Çπ„Ç´„Éñ„É´„Ç¢„Ç§„Ç≥„É≥„ÅØÊßò„ÄÖ„Å™ÂΩ¢Áä∂„Å´„Éû„Çπ„ÇØ„Åï„Çå„Çã„Åü„ÇÅ„ÄÅËÉåÊôØËâ≤„ÇíÊåáÂÆö„Åß„Åç„Åæ„Åô</p>
        </div>
        
        <div class="preview-grid">
            <div class="preview-box original">
                <h3>SVG „Éó„É¨„Éì„É•„Éº</h3>
                <div id="svgPreview" style="min-height: 256px; display: flex; align-items: center; justify-content: center; background: #f0f0f0; border: 2px dashed #ccc; border-radius: 10px;">
                    <span style="color: #999;">SVG„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</span>
                </div>
                <div class="size-info">SVG („Çπ„Ç±„Éº„É©„Éñ„É´)</div>
            </div>
            
            <div class="preview-box">
                <h3>icon-192x192.png <span class="icon-type android">Android</span></h3>
                <div class="canvas-container">
                    <canvas id="canvas192" width="192" height="192"></canvas>
                </div>
                <div class="size-info">192√ó192px</div>
                <button class="download-btn" onclick="downloadPNG('192')" id="btn192" disabled>
                    üì• „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                </button>
            </div>
            
            <div class="preview-box">
                <h3>icon-512x512.png <span class="icon-type android">Android</span></h3>
                <div class="canvas-container">
                    <canvas id="canvas512" width="512" height="512" style="width: 192px; height: 192px;"></canvas>
                </div>
                <div class="size-info">512√ó512px</div>
                <button class="download-btn" onclick="downloadPNG('512')" id="btn512" disabled>
                    üì• „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                </button>
            </div>
            
            <div class="preview-box">
                <h3>icon-512x512-maskable.png <span class="icon-type maskable">Maskable</span></h3>
                <div class="canvas-container maskable">
                    <canvas id="canvas512m" width="512" height="512" style="width: 192px; height: 192px;"></canvas>
                </div>
                <div class="size-info">512√ó512px („Çª„Éº„Éï„Ç®„É™„Ç¢‰ªò„Åç)</div>
                <button class="download-btn" onclick="downloadPNG('512m')" id="btn512m" disabled>
                    üì• „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                </button>
            </div>
            
            <div class="preview-box">
                <h3>apple-touch-icon-180x180.png <span class="icon-type ios">iOS</span></h3>
                <div class="canvas-container">
                    <canvas id="canvas180" width="180" height="180"></canvas>
                </div>
                <div class="size-info">180√ó180px</div>
                <button class="download-btn" onclick="downloadPNG('180')" id="btn180" disabled>
                    üì• „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
                </button>
            </div>
        </div>
        
        <button class="download-btn download-all-btn" onclick="downloadAll()" id="btnAll" disabled>
            üì¶ „Åô„Åπ„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ (ZIP„Éï„Ç°„Ç§„É´)
        </button>
        
        <button class="download-btn" onclick="regenerateAll()">
            üîÑ ÂÜçÁîüÊàê
        </button>
        
        <div class="info">
            <h3>üìù ÁîüÊàê„Åï„Çå„Çã„Ç¢„Ç§„Ç≥„É≥</h3>
            <ul>
                <li><strong>icon-192x192.png</strong> - PWAÁî®Ê®ôÊ∫ñ„Ç¢„Ç§„Ç≥„É≥ (Android)</li>
                <li><strong>icon-512x512.png</strong> - PWAÁî®È´òËß£ÂÉèÂ∫¶„Ç¢„Ç§„Ç≥„É≥ (Android/Play Store)</li>
                <li><strong>icon-512x512-maskable.png</strong> - „Éû„Çπ„Ç´„Éñ„É´„Ç¢„Ç§„Ç≥„É≥ (Android Adaptive Icon)</li>
                <li><strong>apple-touch-icon-180x180.png</strong> - iOSÁî®„Ç¢„Ç§„Ç≥„É≥ (iPhone/iPad)</li>
            </ul>
            
            <h3>üéØ „Éû„Çπ„Ç´„Éñ„É´„Ç¢„Ç§„Ç≥„É≥„Å´„Å§„ÅÑ„Å¶</h3>
            <p>„Éû„Çπ„Ç´„Éñ„É´„Ç¢„Ç§„Ç≥„É≥„ÅØ„ÄÅ„Éá„Éê„Ç§„Çπ„Å´„Çà„Å£„Å¶ÂÜÜÂΩ¢„ÄÅËßí‰∏∏„ÄÅ„ÉÜ„Ç£„Ç¢„Éâ„É≠„ÉÉ„ÉóÂûã„Å™„Å©Êßò„ÄÖ„Å™ÂΩ¢Áä∂„Å´„Éû„Çπ„ÇØ„Åï„Çå„Åæ„Åô„ÄÇ
            ÂÆâÂÖ®È†òÂüüÔºà‰∏≠Â§Æ„ÅÆ80%Ôºâ„Å´„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÈÖçÁΩÆ„Åó„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅ„Å©„ÅÆÂΩ¢Áä∂„Åß„ÇÇÈáçË¶Å„Å™ÈÉ®ÂàÜ„ÅåÂàá„Çå„Åæ„Åõ„Çì„ÄÇ</p>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        const pngDataUrls = {};
        let loadedSvgElement = null;
        
        window.addEventListener('load', function() {
            setupFileUpload();
        });
        
        function setupFileUpload() {
            const fileInput = document.getElementById('svgFile');
            const uploadSection = document.getElementById('uploadSection');
            const uploadText = document.getElementById('uploadText');
            
            fileInput.addEventListener('change', handleSvgUpload);
            setupColorPicker();
            
            // „Éâ„É©„ÉÉ„Ç∞„Ç¢„É≥„Éâ„Éâ„É≠„ÉÉ„Éó„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö
            uploadSection.addEventListener('click', function() {
                fileInput.click();
            });
            
            uploadSection.addEventListener('dragover', function(e) {
                e.preventDefault();
                e.stopPropagation();
                uploadSection.classList.add('drag-over');
                uploadText.classList.add('drag-over');
                uploadText.textContent = 'üéâ „Éï„Ç°„Ç§„É´„Çí„Éâ„É≠„ÉÉ„Éó„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ';
            });
            
            uploadSection.addEventListener('dragleave', function(e) {
                e.preventDefault();
                e.stopPropagation();
                // Ë¶ÅÁ¥†Â§ñ„Å´Âá∫„ÅüÊôÇ„ÅÆ„Åø„É™„Çª„ÉÉ„Éà
                if (!uploadSection.contains(e.relatedTarget)) {
                    uploadSection.classList.remove('drag-over');
                    uploadText.classList.remove('drag-over');
                    uploadText.textContent = 'üìÅ SVG„Éï„Ç°„Ç§„É´„Çí„Åì„Åì„Å´„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó or „ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÅ∏Êäû';
                }
            });
            
            uploadSection.addEventListener('drop', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                uploadSection.classList.remove('drag-over');
                uploadText.classList.remove('drag-over');
                uploadText.textContent = 'üìÅ SVG„Éï„Ç°„Ç§„É´„Çí„Åì„Åì„Å´„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó or „ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÅ∏Êäû';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const file = files[0];
                    handleDroppedFile(file);
                }
            });
            
            // „Éö„Éº„Ç∏ÂÖ®‰Ωì„ÅÆ„Éâ„É©„ÉÉ„Ç∞„Ç™„Éº„Éê„Éº„ÇíÁÑ°ÂäπÂåñ
            document.addEventListener('dragover', function(e) {
                e.preventDefault();
            });
            
            document.addEventListener('drop', function(e) {
                e.preventDefault();
            });
        }
        
        function setupColorPicker() {
            const colorInput = document.getElementById('maskableBackgroundColor');
            const colorValue = document.getElementById('maskableColorValue');
            
            // „Ç´„É©„Éº„Éî„ÉÉ„Ç´„Éº„Å®„ÉÜ„Ç≠„Çπ„Éà„Éï„Ç£„Éº„É´„Éâ„ÇíÂêåÊúü
            colorInput.addEventListener('input', function() {
                colorValue.value = colorInput.value;
                if (loadedSvgElement) {
                    regenerateAllIcons();
                }
            });
            
            colorValue.addEventListener('input', function() {
                const color = colorValue.value;
                if (/^#[0-9A-Fa-f]{6}$/.test(color)) {
                    colorInput.value = color;
                    if (loadedSvgElement) {
                        regenerateAllIcons();
                    }
                }
            });
        }
        
        function regenerateAllIcons() {
            if (!loadedSvgElement) {
                const statusEl = document.getElementById('status');
                statusEl.className = 'status error';
                statusEl.textContent = '‚ö†Ô∏è „Åæ„ÅöSVG„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                return;
            }
            generateAllIcons();
        }
        
        function handleSvgUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            handleDroppedFile(file);
        }
        
        function handleDroppedFile(file) {
            const statusEl = document.getElementById('status');
            const fileNameEl = document.getElementById('fileName');
            
            if (!file.type.includes('svg') && !file.name.toLowerCase().endsWith('.svg')) {
                statusEl.className = 'status error';
                statusEl.textContent = '‚ö†Ô∏è SVG„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ (ÁèæÂú®: ' + (file.type || '‰∏çÊòé„Å™„Éï„Ç°„Ç§„É´„Çø„Ç§„Éó') + ')';
                return;
            }
            
            fileNameEl.textContent = file.name;
            statusEl.className = 'status loading';
            statusEl.textContent = 'SVG„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø‰∏≠...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const svgContent = e.target.result;
                    loadSvgFromContent(svgContent);
                } catch (error) {
                    statusEl.className = 'status error';
                    statusEl.textContent = '‚ö†Ô∏è SVG„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü';
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }
        
        function loadSvgFromContent(svgContent) {
            const statusEl = document.getElementById('status');
            const svgPreview = document.getElementById('svgPreview');
            
            try {
                // SVG„ÇíÂÆâÂÖ®„Å´Ëß£Êûê„Éª„Çµ„Éã„Çø„Ç§„Ç∫
                const parser = new DOMParser();
                const doc = parser.parseFromString(svgContent, 'image/svg+xml');
                let svgElement = doc.documentElement;

                if (!svgElement || svgElement.tagName.toLowerCase() !== 'svg') {
                    throw new Error('ÊúâÂäπ„Å™SVGË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                }

                // Âç±Èô∫Ë¶ÅÁ¥†„Å®Â±ûÊÄß„ÇíÈô§Âéª
                doc.querySelectorAll('script, foreignObject').forEach(el => el.remove());
                doc.querySelectorAll('*').forEach(el => {
                    [...el.attributes].forEach(attr => {
                        const name = attr.name;
                        if (/^on/i.test(name)) el.removeAttribute(name); // onload Á≠â
                        if (name === 'href' || name === 'xlink:href') {
                            const val = attr.value || '';
                            if (/^(https?:)?\\/\\//i.test(val)) el.removeAttribute(name); // Â§ñÈÉ®ÂèÇÁÖß„ÇíÁ¶ÅÊ≠¢
                        }
                    });
                });

                // „Éó„É¨„Éì„É•„Éº„Å´Â∑Æ„ÅóËæº„ÇÄ
                svgPreview.innerHTML = '';
                svgPreview.appendChild(svgElement);
                
                // SVG„Çµ„Ç§„Ç∫„ÇíË™øÊï¥
                svgElement.setAttribute('width', '256');
                svgElement.setAttribute('height', '256');
                svgElement.style.maxWidth = '100%';
                svgElement.style.height = 'auto';
                
                loadedSvgElement = svgElement;
                
                // „Ç´„É©„Éº„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
                document.getElementById('colorSection').style.display = 'block';
                
                statusEl.className = 'status success';
                statusEl.textContent = '‚úÖ SVG„Éï„Ç°„Ç§„É´„ÅåË™≠„ÅøËæº„Åæ„Çå„Åæ„Åó„ÅüÔºÅ „Ç¢„Ç§„Ç≥„É≥„ÇíÁîüÊàê„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                
                // „Ç¢„Ç§„Ç≥„É≥ÁîüÊàê„ÇíÂÆüË°å
                setTimeout(generateAllIcons, 500);
                
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = '‚ö†Ô∏è SVG„Éï„Ç°„Ç§„É´„ÅÆÂá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message;
                console.error(error);
            }
        }
        
        function generateAllIcons() {
            if (!loadedSvgElement) {
                const statusEl = document.getElementById('status');
                statusEl.className = 'status error';
                statusEl.textContent = '‚ö†Ô∏è „Åæ„ÅöSVG„Éï„Ç°„Ç§„É´„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                return;
            }
            
            const statusEl = document.getElementById('status');
            statusEl.className = 'status loading';
            statusEl.textContent = '„Ç¢„Ç§„Ç≥„É≥„ÇíÁîüÊàê‰∏≠...';
            
            // ÂêÑ„Çµ„Ç§„Ç∫„ÅÆ„Ç¢„Ç§„Ç≥„É≥„ÇíÁîüÊàê
            generateIcon(192, 'canvas192', 'btn192', false);
            generateIcon(512, 'canvas512', 'btn512', false);
            generateIcon(512, 'canvas512m', 'btn512m', true); // maskable
            generateIcon(180, 'canvas180', 'btn180', false);
            
            setTimeout(() => {
                statusEl.className = 'status success';
                statusEl.textContent = '‚úÖ „Åô„Åπ„Å¶„ÅÆ„Ç¢„Ç§„Ç≥„É≥„ÅåÁîüÊàê„Åï„Çå„Åæ„Åó„ÅüÔºÅ';
                document.getElementById('btnAll').disabled = false;
            }, 500);
        }
        
        function generateIcon(size, canvasId, btnId, isMaskable) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const btn = document.getElementById(btnId);
            
            if (!loadedSvgElement) {
                btn.disabled = true;
                return;
            }
            
            try {
                ctx.clearRect(0, 0, size, size);
                
                // „Éû„Çπ„Ç´„Éñ„É´„ÅÆÂ†¥Âêà„ÅØÁ∏ÆÂ∞è„Åó„Å¶‰∏≠Â§Æ„Å´ÈÖçÁΩÆÔºà„Çª„Éº„Éï„Ç®„É™„Ç¢ÂØæÂøúÔºâ
                const scaleFactor = isMaskable ? 0.8 : 1.0;
                const actualSize = size * scaleFactor;
                const offset = (size - actualSize) / 2;
                
                // „Éû„Çπ„Ç´„Éñ„É´„Ç¢„Ç§„Ç≥„É≥„ÅÆÂ†¥Âêà„ÄÅÊåáÂÆö„Åï„Çå„ÅüËÉåÊôØËâ≤„ÅßÂÖ®‰Ωì„ÇíÂ°ó„Çä„Å§„Å∂„Åô
                if (isMaskable) {
                    const backgroundColor = document.getElementById('maskableBackgroundColor').value;
                    ctx.fillStyle = backgroundColor;
                    ctx.fillRect(0, 0, size, size);
                }
                
                // SVG„Çí„Ç§„É°„Éº„Ç∏„Å®„Åó„Å¶Ë™≠„ÅøËæº„Çì„Åßcanvas„Å´ÊèèÁîª
                const svgData = new XMLSerializer().serializeToString(loadedSvgElement);
                const svgBlob = new Blob([svgData], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(svgBlob);
                
                const img = new Image();
                img.onload = function() {
                    ctx.drawImage(img, offset, offset, actualSize, actualSize);
                    
                    // „Éá„Éº„ÇøURL„Çí‰øùÂ≠ò
                    const key = isMaskable ? size + 'm' : size.toString();
                    pngDataUrls[key] = canvas.toDataURL('image/png');
                    btn.disabled = false;
                    
                    URL.revokeObjectURL(url);
                };
                
                img.onerror = function() {
                    console.error(`Error loading SVG for ${size}px icon`);
                    btn.disabled = true;
                    URL.revokeObjectURL(url);
                };
                
                img.src = url;
                
            } catch (e) {
                console.error(`Error generating ${size}px icon:`, e);
                btn.disabled = true;
            }
        }
        
        function regenerateAll() {
            regenerateAllIcons();
        }
        
        function downloadPNG(sizeKey) {
            const dataUrl = pngDataUrls[sizeKey];
            if (!dataUrl) {
                alert('„Ç¢„Ç§„Ç≥„É≥„Åå„Åæ„Å†ÁîüÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ');
                return;
            }
            
            let filename;
            switch(sizeKey) {
                case '192':
                    filename = 'icon-192x192.png';
                    break;
                case '512':
                    filename = 'icon-512x512.png';
                    break;
                case '512m':
                    filename = 'icon-512x512-maskable.png';
                    break;
                case '180':
                    filename = 'apple-touch-icon-180x180.png';
                    break;
            }
            
            // „Éá„Éº„ÇøURL„Åã„ÇâBlob„Çí‰ΩúÊàê„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
            const arr = dataUrl.split(',');
            const mime = arr[0].match(/:(.*?);/)[1];
            const bstr = atob(arr[1]);
            let n = bstr.length;
            const u8arr = new Uint8Array(n);
            
            while(n--){
                u8arr[n] = bstr.charCodeAt(n);
            }
            
            const blob = new Blob([u8arr], {type: mime});
            saveAs(blob, filename);
        }
        
        async function downloadAll() {
            const zip = new JSZip();
            
            // ÂêÑ„Ç¢„Ç§„Ç≥„É≥„ÇíZIP„Å´ËøΩÂä†
            const icons = [
                { key: '192', name: 'icon-192x192.png' },
                { key: '512', name: 'icon-512x512.png' },
                { key: '512m', name: 'icon-512x512-maskable.png' },
                { key: '180', name: 'apple-touch-icon-180x180.png' }
            ];
            
            for (const icon of icons) {
                const dataUrl = pngDataUrls[icon.key];
                if (dataUrl) {
                    // „Éá„Éº„ÇøURL„Åã„ÇâBase64ÈÉ®ÂàÜ„ÇíÊäΩÂá∫
                    const base64 = dataUrl.split(',')[1];
                    zip.file(icon.name, base64, {base64: true});
                }
            }
            
            // manifest.json „ÅÆ„Çµ„É≥„Éó„É´„ÇÇËøΩÂä†
            const manifest = {
                "name": "Your App Name",
                "short_name": "YourApp",
                "icons": [
                    {
                        "src": "icon-192x192.png",
                        "sizes": "192x192",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon-512x512.png",
                        "sizes": "512x512",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": "icon-512x512-maskable.png",
                        "sizes": "512x512",
                        "type": "image/png",
                        "purpose": "maskable"
                    }
                ],
                "theme_color": "#000000",
                "background_color": "#ffffff",
                "display": "standalone"
            };
            
            zip.file("manifest.json", JSON.stringify(manifest, null, 2));
            
            // ZIP„Éï„Ç°„Ç§„É´„ÇíÁîüÊàê„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
            const content = await zip.generateAsync({type: "blob"});
            const timestamp = new Date().toISOString().slice(0, 10);
            saveAs(content, `app-icons-${timestamp}.zip`);
        }
    </script>
</body>
</html>